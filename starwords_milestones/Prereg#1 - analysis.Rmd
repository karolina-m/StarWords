---
title: ""
author: ""
date: ""
output:
  html_document:
    toc: true
    toc_depth: 4
    toc_float: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, warning = FALSE, include = FALSE)
options(digits = 2)
```

```{r, echo = F, include = F}
library(tidyverse)
library(lubridate)
library(readxl)
library(knitr)
library(kableExtra)
library(data.table)
library(infer)
library(Rmisc)
library(plotly)
library(gtsummary)
library(rempsyc)
library(flextable)
library(rstatix)
library(BayesFactor)
library(cowplot)
library(effsize)
library(car)
library(bain)

```

```{r colorize, echo = F, include = F}
colorize <- function(x, color) {
  if (knitr::is_latex_output()) {
    sprintf("\\textcolor{%s}{%s}", color, x)
  } else if (knitr::is_html_output()) {
    sprintf("<span style='color: %s;'>%s</span>", color,
      x)
  } else x
}
```


### Bilingual milestones in early language development
#### A part of the project: StarWords: a study of parental report on words
##### Pre-registraiton #1, see https://osf.io/pzykv


### Participants
Below data from children who  
- match recruitment criteria (according to pre-registration) plus children bilingual with Polish and other language (meeting recruitment criteria).  
- do not have any health problems (following pre-registration criteria).  
- are matched one-to-one.  
  
*Note 1. This is how many children meet the criteria, but later we'll see how much data from them we actually have.*

```{r export table}
# export APA table to Word

kids <- read.csv2("kids.csv")
str(kids)

kids %>% filter(match == "match1") %>%
  group_by(group) %>%
  summarise(n = dplyr::n(),
            "Entry age (M)" = mean(age_at_study_entry),
            "Entry age (SD)" = sd(age_at_study_entry),
            "Entry age (min)" = min(age_at_study_entry),
            "Entry age (max)" = max(age_at_study_entry),
            "Days reporting (M)" = mean(days_reporting, na.rm = T),
            "Days reporting (SD)" = sd(days_reporting, na.rm = T),
            "Days reporting (min)" = min(days_reporting, na.rm = T),
            "Days reporting (max)" = max(days_reporting, na.rm = T),
            .groups = "keep")

```

```{r export table2}
# parental edu
kids %>% filter(match == "match1") %>%
  group_by(group, parental_edu) %>%
  summarise(n = dplyr::n(),
            .groups = "keep")
```

``` {r match1 compare gender}

# gender
kids %>% filter(match == "match1") %>%
  group_by(group, sex) %>%
  summarise(n = dplyr::n(), .groups = "keep") %>%
  pivot_wider(names_from = group, values_from = n) %>% 
  knitr::kable(digits = 1,
        col.names = c("", "Monolinguals", "Bilinguals")) %>%
  kable_styling(full_width = F,
              bootstrap_options = c("striped", "hover", "condensed"),
              position = "center")


```

#### Checking whether the match was succesfull
We're checking whether the groups differ on matching variables: age on study entry, parental education, gender and length of parental reporting. The matching was done one to one - for each bilingual child we found a similiar monolingual child in the data set.  
Note: Since we lacked parental edu information for many children (671 monolinguals and 179 bilinguals), I included a dummy level of parental education “0” (meaning: no data available); as a result, out of 302 pairs, 179 were matched on missing information (level “0”), and the remaining children were matched on the reported parental education level (six levels: PhD, higher education, unfinished higher education, vocational, secondary and primary education). This was the only way I could think of to match the children with some info, but at the same time not exclude children with no information from the match (and analyses).

### Table 1 and A1
```{r, include = T, echo = F}

# gender
kids %>%
  group_by(group, sex) %>%
  summarise(n = dplyr::n(), .groups = "keep") %>%
  pivot_wider(names_from = group, values_from = n) %>%
  knitr::kable(digits = 1,
        col.names = c("", "Bilinguals", "Monolinguals1", "Monolinguals2")) %>%
  kable_styling(full_width = F,
              bootstrap_options = c("striped", "hover", "condensed"),
              position = "center")

# ses
kids$parental_edu <- as.factor(kids$parental_edu)
kids$parental_edu <- ordered(kids$parental_edu, c("PHD", "HIGHER_EDU", "UNFINISHED_HIGHER_EDU", "TECHNICAL", "SECONDARY", "PRIMARY", "NoInfo"))

kids %>%
  group_by(group, parental_edu) %>%
  summarise(n = dplyr::n(), .groups = "keep") %>%
  pivot_wider(names_from = group, values_from = n) %>%
  knitr::kable(digits = 1,
        col.names = c("", "Bilinguals", "Monolinguals1", "Monolinguals2")) %>%
  kable_styling(full_width = F,
              bootstrap_options = c("striped", "hover", "condensed"),
              position = "center")



```


```{r check matches}
# match1
match1 <- kids %>% filter(match == "match1")
match2 <- kids %>% filter(match == "match2" | match == "match1" & group == "Bilinguals")
str(match1)
str(match2)

# sex
chisq.test(table(match1$group, match1$sex))

# ses
match1$parental_edu <- match1$parental_edu %>% replace_na("NoInfo")
chisq.test(table(match1$group, match1$parental_edu))
fisher.test(table(match1$group, match1$parental_edu))

# age at study entry
match1 %>% rstatix::t_test(age_at_study_entry ~ group, paired = F)

# days reporting
match1 %>% rstatix::t_test(formula = days_reporting ~ group, paired = F)

# match 1 and match 2 (bilinguals vs. 2 groups of monolinguals)
# sex
chisq.test(table(kids$group, kids$sex))

# ses
kids$parental_edu <- kids$parental_edu %>% replace_na("NoInfo")
chisq.test(table(kids$group, kids$parental_edu))

# age
summary(aov(age_at_study_entry ~ group, data = kids))

# days reporting
summary(aov(days_reporting ~ group, data = kids))


```

### Our research questions
1. RQ1: Will bilinguals reach particular language milestones at a similar time as their Polish monolingual peers, **at least in one of their languages**?  
2. RQ2: Will bilinguals reach particular language milestones at a similar time **in both their languages, L1 and L2**? 
3. `r colorize("RQ3: In bilinguals, is language-specific (L1/L2) mean **input quantity** before reaching a milestone linked to the age of reaching that milestone (in L1/L2)?", "grey")`  
4. `r colorize("RQ4: In bilinguals, is language-specific (L1/L2) **input quality** linked to the age of reaching language milestones (in L1/L2)?", "grey")`    


### RQ1: Bilinguals vs. monolinguals
These analyses include the bilingual group (n = 302) and one monolingual group, from the first match (n = 302). In the Supplementary Materials below you'll find the comparisons between the bilingual group and the two monolingual groups.  


*Note 1.* For motor milestones and babbling: 'How old was your child when they started....'    
*Note 2.* For words and utterances milestones: The number of words reported by the parent in the app.  
*Note 3.* We count all bilinguals' words together (e.g. Polish + English).  


```{r Words RQ1}
# filter in the vars needed for further analyses
words <- read.csv2("words.csv")

words <- words %>% 
  arrange(word_number_old) %>%
  group_by(child_anonim) %>%
  mutate(word_number = dplyr::row_number()) %>%
  dplyr::relocate(word_number, .after = word_number_old) %>% select(-word_number_old)


words_rq1 <- words %>%
  filter(word_number == 1 | word_number == 10 | word_number == 50) %>%
  select(c(child_anonim, group, form, word_number, age_at_element))

# reformat to wide
words_rq1_wider <- words_rq1 %>%
  pivot_wider(id_cols = c(child_anonim, group), names_from = word_number, values_from = age_at_element) %>%
  rename("w1" = "1", "w10" = "10", "w50" = "50")

```


```{r Multiwords RQ1}
multiwords <- read.csv2("multiwords.csv")

# long to wide
multiwords_wider <- multiwords %>% ungroup() %>%
  dplyr::select(child_anonim, m_cat, age_at_element) %>%
    filter(m_cat == "m1" |
           m_cat == "m3" |
           m_cat == "m4")

# order factor m_cat
multiwords_wider$m_cat <- factor(multiwords_wider$m_cat, ordered = T, levels = c("m1", "m3", "m4"))
multiwords_wider <- multiwords_wider %>%
  pivot_wider(id_cols = child_anonim, names_from = m_cat, values_from = age_at_element,
              values_fill = NA) %>% unnest()


rq1 <- merge(kids[, c("child_anonim", "match", "group")], multiwords_wider, by = "child_anonim", all.x = T)
rq1 <- merge(rq1, words_rq1_wider[, c("child_anonim", "w1", "w10", "w50")], by = "child_anonim", all.x = T)

# # we take match 1 only
# rq1 <- rq1 %>% filter(group == "Bilinguals" | group == "Monolinguals1")

```


```{r, include = T, echo=FALSE, warning=FALSE}
# we add data on reported/recalled milestones
milestones <- read.csv2("milestones.csv")

rq1 <- merge(rq1, milestones[,c("child_anonim", "crawling_age", "walking_age", "babbling_age")], by = "child_anonim", all.x = T)
rq1$group <- dplyr::recode_factor(rq1$group, "Bilinguals" = "Bilinguals", "Monolinguals1" = "Monolinguals")

```

```{r, include = T, echo=FALSE, warning=FALSE}
# we remove Monolinguals2 from the second match
# we take only the vars we want for RQ1
lineplot_rq1 <- rq1 %>%
  filter(group != "Monolinguals2") %>%
  dplyr::select("child_anonim", "group",
         "crawling_age", "babbling_age", "walking_age",
         "w1", "w10", "w50",
         "m1", "m3", "m4")

lineplot_rq1 <- lineplot_rq1 %>%
  rename("crawling" = "crawling_age",
         "babbling" = "babbling_age",
         "walking" = "walking_age")

```


```{r}
# wide to long
lineplot_rq1_longer <- lineplot_rq1 %>%
  pivot_longer(cols = 3:11, names_to = "milestone", values_to = "age_at_element")

lineplot_rq1_longer <- lineplot_rq1_longer %>% unique()

lineplot_rq1_longer$milestone <- factor(lineplot_rq1_longer$milestone, ordered = T, levels = c("crawling", "babbling", "walking","w1", "w10", "w50", "m1", "m3", "m4"))
```

```{r rq1 outliers}
# view the data for potential outliers
lineplot_rq1_longer %>% ggplot(aes(x = milestone, y = age_at_element, fill = group)) + geom_boxplot() + geom_jitter() +
  theme(legend.position = "bottom")

# identify outliers (rstatix::identify...)
rq1_outliers <- lineplot_rq1_longer %>%
  dplyr::group_by(group, milestone) %>% 
  identify_outliers("age_at_element")

# mark outliers in the dataset and filter out
lineplot_rq1_longer <- merge(lineplot_rq1_longer, rq1_outliers[, c("child_anonim", "milestone", "is.outlier")], all.x = T)

lineplot_rq1_longer <- lineplot_rq1_longer %>% filter(is.na(is.outlier))

```


#### Table 3 - descriptive stats

```{r, include = T, echo=FALSE, warning=FALSE}

specify_decimal <- function(x, k) trimws(format(round(x, k), nsmall=k))

lineplot_rq1_longer %>%
  filter(!is.na(group)) %>%
  group_by(milestone, group) %>%
  summarise(
  "n" = sum(!is.na(age_at_element)),
  "Age (M)" = specify_decimal(mean(age_at_element, na.rm = T),2),
  "Age (SD)" = specify_decimal(sd(age_at_element, na.rm = T),2)) %>%
  kable("html") %>% kable_styling()

```

#### Figure 1
```{r Figure1, include = T, echo=FALSE, warning=FALSE}
lineplot_rq1_sum <- summarySE(lineplot_rq1_longer, measurevar = "age_at_element", groupvars = c("milestone", "group"), na.rm = T)

lineplot_rq1_sum <- lineplot_rq1_sum %>%
  mutate(source = dplyr::case_when(
    milestone == "babbling" ~ "parental recall",
    milestone == "crawling" ~ "parental recall",
    milestone == "walking" ~ "parental recall",
    TRUE ~ "parental report",
  ))


fig1a <- lineplot_rq1_sum %>%
  filter(source == "parental recall") %>%
  ggplot(aes(x=milestone, y=age_at_element, group=group, color=group)) + 
  geom_line(aes(linetype=group)) +
  geom_point(position=position_dodge(0.03)) +
  geom_errorbar(aes(ymin=age_at_element-ci, ymax=age_at_element+ci),
                width=0.5, 
                position=position_dodge(0.03)) +
  scale_y_continuous(limits = c(4,28), breaks = c(4, 6, 8, 10, 12, 14, 16, 18, 20, 22, 24, 26, 28)) +
  scale_x_discrete(labels = c("Crawling \n B n = 77 \n M n = 74",
                              "Babbling \n B n = 58 \n M n = 54",
                              "Walking \n B n = 49 \n M n = 43")) +
  scale_color_brewer(type = "qual", palette = 6) +
  labs(title = "Parental report/recall") +
  ylab("Age at reaching milestone") + xlab("") +
  theme(legend.position = "bottom",
        legend.title = element_blank(),
        panel.background = element_rect(fill = "white", colour = "white", linetype = "solid"),
        panel.grid.major = element_line(linetype = "solid", colour = "grey90"))


fig1b <- lineplot_rq1_sum %>%
  filter(source == "parental report") %>%
  ggplot(aes(x=milestone, y=age_at_element, group=group, color=group)) + 
  geom_line(aes(linetype=group)) +
  geom_point(position=position_dodge(0.03)) +
  geom_errorbar(aes(ymin=age_at_element-ci, ymax=age_at_element+ci),
                width=0.5, 
                position=position_dodge(0.03)) +
  scale_y_continuous(limits = c(4,28), breaks = c(4, 6, 8, 10, 12, 14, 16, 18, 20, 22, 24, 26, 28)) +
  scale_x_discrete(labels = c("1st word \n B n = 140 \n M n = 137",
                              "10th word  \n B n = 50 \n M n = 47",
                              "50th word  \n B n = 15 \n M n = 14",
                              "1st multiword \n B n = 34 \n M n = 41",
                              "3-word utt. \n B n = 14 \n M n = 18",
                              "4-word utt. \n B n = 3 \n M n = 6")) +
  scale_color_brewer(type = "qual", palette = 6) +
  ylab("Age at reaching milestone") + xlab("") +
  labs(title = "Parental report") +
  theme(legend.position = "bottom",
        legend.title = element_blank(),
        panel.background = element_rect(fill = "white", colour = "white", linetype = "solid"),
        panel.grid.major = element_line(linetype = "solid", colour = "grey90"))

legend_bottom <- get_legend(
  fig1a + 
    guides(color = guide_legend(nrow = 1)) +
    theme(legend.position = "bottom"))

legend_right <- get_legend(
  # create some space to the left of the legend
  fig1b + theme(legend.box.margin = margin(0, 0, 0, 50)))

title <- ggdraw() + 
  draw_label("Error bars indicate 95% CI", size = 9, hjust = 1) +
  theme(
    # add margin on the left of the drawing canvas,
    # so title is aligned with left edge of first plot
    plot.margin = margin(0, 0, 0, 50))

plot_grid(fig1a, fig1b, title, align = "h",  rel_widths = c(1,2), rel_heights = c(1, .1))
ggsave("fig1.jpeg", dpi = 250, width = 1900, height = 1000, units = "px")
```

##### Figure 1 alternative option A:
Issue #1
[x] remove crawling and walking but keep babbling in
[x] remove the two facets (panels) and merge into a single plot (and remove caption/title on top)
[x] maybe remove linetype by group and make both lines grey/dotted (and add transparency) to not suggest (so much) the longitudinal aspect of the plot? I don't think removing the lines altogether is a good option, especially since for some (few) children this is longitudinal data.
[x] larger breaks on the y axis? maybe by 6 months? --> MK: did 4 months

```{r Figure 1 option A}
#filter crawling and walking but keep babbling in 
lineplot_rq1_longer_filtered <- lineplot_rq1_longer %>%
  filter(milestone != "crawling" & milestone != "walking")
#drop unused levels
lineplot_rq1_longer_filtered$milestone <- fct_drop(lineplot_rq1_longer_filtered$milestone)
#check
table(lineplot_rq1_longer_filtered$milestone)
#summary
lineplot_rq1_sum_filtered <- summarySE(lineplot_rq1_longer_filtered, measurevar = "age_at_element", groupvars = c("milestone", "group"), na.rm = T)

fig1_optA <- lineplot_rq1_sum_filtered %>%
  ggplot(aes(x=milestone, y=age_at_element, group=group, color=group)) + 
  geom_line(linetype = 2, color = "black", alpha = .3) + #remove coloring by group and alpha
  geom_point(position=position_dodge(0.03)) +
  geom_errorbar(aes(ymin=age_at_element-ci, ymax=age_at_element+ci),
                width=0.5, 
                position=position_dodge(0.03)) +
  scale_y_continuous(limits = c(4,28), breaks = c(4, 8, 12, 16, 20, 24, 28)) + 
  #change breaks
  scale_x_discrete(labels = c("babbling" ="Babbling \n B n = 58 \n M n = 54",
                              "w1" ="1st word \n B n = 140 \n M n = 137",
                              "w10" = "10th word  \n B n = 50 \n M n = 47",
                              "w50" = "50th word  \n B n = 15 \n M n = 14",
                              "m1" = "1st multiword \n B n = 34 \n M n = 41",
                            "m3" = "3-word utt. \n B n = 14 \n M n = 18",
                            "m4" = "4-word utt. \n B n = 3 \n M n = 6")) + 
  #added original lables to have more control
  scale_color_brewer(type = "qual", palette = 6) +
  labs(y ="Age at reaching milestone", x = NULL,
       caption = "Error bars indicate 95% CI")  +
  theme(legend.position = "bottom",
        legend.title = element_blank(),
        plot.caption = element_text(hjust = 0), #caption to the left
        panel.background = element_rect(fill = "white", colour = "white", linetype = "solid"),
        panel.grid.major = element_line(linetype = "solid", colour = "grey90"))

fig1_optA

#ggsave("fig1_optA.jpeg", dpi = 250, width = 1900, height = 1000, units = "px")
```
##### Figure 1 alternative option B:
Figure 1 option B:
Suggested by PH and EH
[x] panel with with vocabulary milestones and utterance (?) milestones
[x] separate plot for recall

```{r Figure 1 option B}
#summary
lineplot_rq1_sum <- summarySE(lineplot_rq1_longer, measurevar = "age_at_element", groupvars = c("milestone", "group"), na.rm = T)

#divide into vocabulary and utterance milestones
lineplot_rq1_sum <- lineplot_rq1_sum %>%
  mutate(source = dplyr::case_when(
    milestone == "babbling" ~ "parental recall",
    milestone == "crawling" ~ "parental recall",
    milestone == "walking" ~ "parental recall",
    milestone == "w1" ~ "vocabulary milestone",
    milestone == "w10" ~ "vocabulary milestone",
    milestone == "w50" ~ "vocabulary milestone",
    TRUE ~ "utterance milestone",
  ))

#recall - this will be a separate plot
fig1_optB_recall <- lineplot_rq1_sum %>%
  filter(source == "parental recall") %>%
  ggplot(aes(x=milestone, y=age_at_element, group=group, color=group)) + 
  geom_line(linetype = 2, color = "black", alpha = .3) + #remove coloring by group and alpha
  geom_point(position=position_dodge(0.03)) +
  geom_errorbar(aes(ymin=age_at_element-ci, ymax=age_at_element+ci),
                width=0.5, 
                position=position_dodge(0.03)) +
  scale_y_continuous(limits = c(4,28), breaks = c(4, 8, 12, 16, 20, 24, 28)) + 
  #change breaks
  scale_x_discrete(labels = c("crawling" = "Crawling \n B n = 77 \n M n = 74",
                              "babbling" = "Babbling \n B n = 58 \n M n = 54",
                            "walking" = "Walking \n B n = 49 \n M n = 43")) + 
  #added original lables to have more control
  scale_color_brewer(type = "qual", palette = 6) +
  labs(y ="Age at reaching milestone", x = NULL,
       caption = "Error bars indicate 95% CI")  +
  theme(legend.position = "bottom",
        legend.title = element_blank(),
        plot.caption = element_text(hjust = 0), #caption to the left
        panel.background = element_rect(fill = "white", colour = "white", linetype = "solid"),
        panel.grid.major = element_line(linetype = "solid", colour = "grey90"))

fig1_optB_recall 
#save and change width and height
#ggsave("fig1_optB_recall.jpeg", dpi = 250, width = 1000, height = 1000, units = "px")

#vocabulary milestones
fig1a_optB <- lineplot_rq1_sum %>%
  filter(source == "vocabulary milestone") %>%
  ggplot(aes(x=milestone, y=age_at_element, group=group, color=group)) + 
  geom_line(linetype = 2, color = "black", alpha = .3) +
  geom_point(position=position_dodge(0.03)) +
  geom_errorbar(aes(ymin=age_at_element-ci, ymax=age_at_element+ci),
                width=0.5, 
                position=position_dodge(0.03)) +
  scale_y_continuous(limits = c(4,28), breaks = c(4, 8, 12, 16, 20, 24, 28)) + 
  scale_x_discrete(labels = c("w1" ="1st word \n B n = 140 \n M n = 137",
                              "w10" = "10th word  \n B n = 50 \n M n = 47",
                              "w50" = "50th word  \n B n = 15 \n M n = 14")) +
  scale_color_brewer(type = "qual", palette = 6) +
  ylab("Age at reaching milestone") + xlab("") +
  labs(title = "Vocabulary milestones", caption = "Error bars indicate 95% CI") + #add caption
  theme(legend.position = "bottom",
        legend.title = element_blank(),
        plot.caption = element_text(hjust = 0), #caption to the left
        panel.background = element_rect(fill = "white", colour = "white", linetype = "solid"),
        panel.grid.major = element_line(linetype = "solid", colour = "grey90"))

fig1a_optB

#utterance milestones
fig1b_optB <- lineplot_rq1_sum %>%
  filter(source == "utterance milestone") %>%
  ggplot(aes(x=milestone, y=age_at_element, group=group, color=group)) + 
  geom_line(linetype = 2, color = "black", alpha = .3) +
  geom_point(position=position_dodge(0.03)) +
  geom_errorbar(aes(ymin=age_at_element-ci, ymax=age_at_element+ci),
                width=0.5, 
                position=position_dodge(0.03)) +
  scale_y_continuous(limits = c(4,28), breaks = c(4, 8, 12, 16, 20, 24, 28)) + 
  scale_x_discrete(labels = c("m1" = "1st multiword \n B n = 34 \n M n = 41",
                            "m3" = "3-word utt. \n B n = 14 \n M n = 18",
                            "m4" = "4-word utt. \n B n = 3 \n M n = 6")) +
  scale_color_brewer(type = "qual", palette = 6) +
  ylab("Age at reaching milestone") + xlab("") +
  labs(title = "Utterance milestones") +
  theme(legend.position = "bottom",
        legend.title = element_blank(),
        panel.background = element_rect(fill = "white", colour = "white", linetype = "solid"),
        panel.grid.major = element_line(linetype = "solid", colour = "grey90"))

fig1b_optB

legend_bottom <- get_legend(
  fig1a_optB + 
    guides(color = guide_legend(nrow = 1)) +
    theme(legend.position = "bottom"))

legend_right <- get_legend(
  # create some space to the left of the legend
  fig1b_optB + theme(legend.box.margin = margin(0, 0, 0, 50)))

plot_grid(fig1a_optB, fig1b_optB, align = "h",  rel_widths = c(1,2), rel_heights = c(1, .1))
#ggsave("fig1a_optB.jpeg", dpi = 250, width = 1900, height = 1000, units = "px")
```

#### RQ1: t-tests
```{r ttest, include = T, echo = F}

lineplot_rq1_longer %>%
  filter(group == "Bilinguals" | group == "Monolinguals") %>%
  filter(milestone != "m4") %>%
  group_by(milestone) %>%
  rstatix::t_test(data = ., formula = age_at_element ~ group, alternative = "two.sided", conf.level = 0.95, detailed = T) %>%
  adjust_pvalue(method = "holm") %>%
  add_significance("p.adj") %>%
  kable("html") %>% kable_styling()

```

#### RQ1: Bayes Factor
```{r, include = T, echo= T, warning=FALSE}

# Following Hoijtink, H., Mulder, J., Van Lissa, C., & Gu, X. (2019). A tutorial on testing hypotheses using the Bayes factor. Psychological Methods, 24(5), 539–556. https://doi.org/10.1037/met0000201

citation("bain")

```

#### Crawling

```{r, include = T, echo= T, warning=FALSE}
# crawling

bf_rq1 <- lineplot_rq1 %>%
  filter(group == "Bilinguals" | group == "Monolinguals")

prepbf <- bain::t_test(bf_rq1$crawling ~ bf_rq1$group, var.equal = T)

set.seed(100)
resbf<-bain(prepbf,"groupBilinguals = groupMonolinguals")
resbf
summary(resbf, ci=0.95)

# Sensitivity Analysis
# compute BF01 using b-g (same BF as printed above)
set.seed(100)
resbf_sa<-bain(prepbf,"groupBilinguals = groupMonolinguals", fraction = 1)
print(resbf_sa)
# compute BF01 replacing b-g by 2 x b-g
# setting fraction to 2 implies using 2 x b-g
set.seed(100)
resbf_sa<-bain(prepbf,"groupBilinguals = groupMonolinguals", fraction = 2)
print(resbf_sa)
# compute BF01 replacing b-g by 3 x b-g
set.seed(100)
resbf_sa<-bain(prepbf,"groupBilinguals = groupMonolinguals", fraction = 3)
print(resbf_sa)

```

#### Babbling

```{r, include = T, echo= T, warning=FALSE}
# babbling
prepbf <- bain::t_test(bf_rq1$babbling ~ bf_rq1$group, var.equal = T)
set.seed(100)
resbf<-bain(prepbf,"groupBilinguals = groupMonolinguals")
resbf

# Sensitivity Analysis
# compute BF01 using b-g (same BF as printed above)
set.seed(100)
resbf_sa<-bain(prepbf,"groupBilinguals = groupMonolinguals", fraction = 1)
print(resbf_sa)
# compute BF01 replacing b-g by 2 x b-g
# setting fraction to 2 implies using 2 x b-g
set.seed(100)
resbf_sa<-bain(prepbf,"groupBilinguals = groupMonolinguals", fraction = 2)
print(resbf_sa)
# compute BF01 replacing b-g by 3 x b-g
set.seed(100)
resbf_sa<-bain(prepbf,"groupBilinguals = groupMonolinguals", fraction = 3)
print(resbf_sa)
```


#### Walking

```{r, include = T, echo= T, warning=FALSE}
# walking
prepbf <- bain::t_test(bf_rq1$walking ~ bf_rq1$group, var.equal = T)
set.seed(100)
resbf<-bain(prepbf,"groupBilinguals = groupMonolinguals")
resbf

# Sensitivity Analysis
# compute BF01 using b-g (same BF as printed above)
set.seed(100)
resbf_sa<-bain(prepbf,"groupBilinguals = groupMonolinguals", fraction = 1)
print(resbf_sa)
# compute BF01 replacing b-g by 2 x b-g
# setting fraction to 2 implies using 2 x b-g
set.seed(100)
resbf_sa<-bain(prepbf,"groupBilinguals = groupMonolinguals", fraction = 2)
print(resbf_sa)
# compute BF01 replacing b-g by 3 x b-g
set.seed(100)
resbf_sa<-bain(prepbf,"groupBilinguals = groupMonolinguals", fraction = 3)
print(resbf_sa)
```

#### Word1

```{r, include = T, echo= T, warning=FALSE}
# word1
prepbf <- bain::t_test(bf_rq1$w1 ~ bf_rq1$group, var.equal = T)
set.seed(100)
resbf<-bain(prepbf,"groupBilinguals = groupMonolinguals")
resbf

# Sensitivity Analysis
# compute BF01 using b-g (same BF as printed above)
set.seed(100)
resbf_sa<-bain(prepbf,"groupBilinguals = groupMonolinguals", fraction = 1)
print(resbf_sa)
# compute BF01 replacing b-g by 2 x b-g
# setting fraction to 2 implies using 2 x b-g
set.seed(100)
resbf_sa<-bain(prepbf,"groupBilinguals = groupMonolinguals", fraction = 2)
print(resbf_sa)
# compute BF01 replacing b-g by 3 x b-g
set.seed(100)
resbf_sa<-bain(prepbf,"groupBilinguals = groupMonolinguals", fraction = 3)
print(resbf_sa)
```

#### Word10

```{r, include = T, echo= T, warning=FALSE}
# word10
prepbf <- bain::t_test(bf_rq1$w10 ~ bf_rq1$group, var.equal = T)
set.seed(100)
resbf<-bain(prepbf,"groupBilinguals = groupMonolinguals")
resbf

# Sensitivity Analysis
# compute BF01 using b-g (same BF as printed above)
set.seed(100)
resbf_sa<-bain(prepbf,"groupBilinguals = groupMonolinguals", fraction = 1)
print(resbf_sa)
# compute BF01 replacing b-g by 2 x b-g
# setting fraction to 2 implies using 2 x b-g
set.seed(100)
resbf_sa<-bain(prepbf,"groupBilinguals = groupMonolinguals", fraction = 2)
print(resbf_sa)
# compute BF01 replacing b-g by 3 x b-g
set.seed(100)
resbf_sa<-bain(prepbf,"groupBilinguals = groupMonolinguals", fraction = 3)
print(resbf_sa)
```

#### Word50

```{r, include = T, echo= T, warning=FALSE}
# word50
prepbf <- bain::t_test(bf_rq1$w50 ~ bf_rq1$group, var.equal = T)
set.seed(100)
resbf<-bain(prepbf,"groupBilinguals = groupMonolinguals")
resbf

# Sensitivity Analysis
# compute BF01 using b-g (same BF as printed above)
set.seed(100)
resbf_sa<-bain(prepbf,"groupBilinguals = groupMonolinguals", fraction = 1)
print(resbf_sa)
# compute BF01 replacing b-g by 2 x b-g
# setting fraction to 2 implies using 2 x b-g
set.seed(100)
resbf_sa<-bain(prepbf,"groupBilinguals = groupMonolinguals", fraction = 2)
print(resbf_sa)
# compute BF01 replacing b-g by 3 x b-g
set.seed(100)
resbf_sa<-bain(prepbf,"groupBilinguals = groupMonolinguals", fraction = 3)
print(resbf_sa)
```

#### Multiword1

```{r, include = T, echo= T, warning=FALSE}
# multiword1
prepbf <- bain::t_test(bf_rq1$m1 ~ bf_rq1$group, var.equal = T)
set.seed(100)
resbf<-bain(prepbf,"groupBilinguals = groupMonolinguals")
resbf

# Sensitivity Analysis
# compute BF01 using b-g (same BF as printed above)
set.seed(100)
resbf_sa<-bain(prepbf,"groupBilinguals = groupMonolinguals", fraction = 1)
print(resbf_sa)
# compute BF01 replacing b-g by 2 x b-g
# setting fraction to 2 implies using 2 x b-g
set.seed(100)
resbf_sa<-bain(prepbf,"groupBilinguals = groupMonolinguals", fraction = 2)
print(resbf_sa)
# compute BF01 replacing b-g by 3 x b-g
set.seed(100)
resbf_sa<-bain(prepbf,"groupBilinguals = groupMonolinguals", fraction = 3)
print(resbf_sa)
```

#### Multiword3

```{r, include = T, echo= T, warning=FALSE}
# multiword3
prepbf <- bain::t_test(bf_rq1$m3 ~ bf_rq1$group, var.equal = T)
set.seed(100)
resbf<-bain(prepbf,"groupBilinguals = groupMonolinguals")
resbf

# Sensitivity Analysis
# compute BF01 using b-g (same BF as printed above)
set.seed(100)
resbf_sa<-bain(prepbf,"groupBilinguals = groupMonolinguals", fraction = 1)
print(resbf_sa)
# compute BF01 replacing b-g by 2 x b-g
# setting fraction to 2 implies using 2 x b-g
set.seed(100)
resbf_sa<-bain(prepbf,"groupBilinguals = groupMonolinguals", fraction = 2)
print(resbf_sa)
# compute BF01 replacing b-g by 3 x b-g
set.seed(100)
resbf_sa<-bain(prepbf,"groupBilinguals = groupMonolinguals", fraction = 3)
print(resbf_sa)
```

#### Multiword4
Samples too small to run the analyses.


### RQ2: Bilinguals' L1 vs. L2
These analyses include the whole bilingual group (n = 302), including children with majority languages other than English (in the UK) and Norwegian (for a subset of children, see Appendix B).


*Note 1.* For milestones regarding words and utterances: we use the number of words reported by the parent in the app.  
*Note 2.* If a word/utterance was marked as belonging to two languages (e.g. Polish and English), we count the word twice, for the Polish milestones and the other-language milestones.  
*Note 3.* For each milestone, we consider only bilinguals who have this milestone (e.g. w1, w10) reported in both languages.


```{r bi}
bi <- kids %>%
  filter(group == "Bilinguals") %>%
  unique()

```

```{r wordsrq2}
words_longer <- words %>% 
  arrange(child_anonim) %>%
  pivot_longer(cols = c("l1", "l2", "l3"),
               names_to = "language_nr",
               values_to = "language_name") %>%
  relocate(language_name, .after = meaning) %>%
  relocate(language_nr, .after = meaning) %>%
  filter(language_name != "NA") %>%
  mutate(
    language_new = dplyr::if_else(language_name == "Polish", "HL", "ML")) %>%
  dplyr::relocate(language_new, .after = language_name)

# remove old "word's number" (ordinal number) from rq1 - now if a word was reported in two languages, it will be counted twice,
# once for HL vocab and once for ML vocab size
words_rq2 <- words_longer %>% 
  group_by(child_anonim, language_new) %>%
  arrange(child_anonim, word_number) %>%
  mutate(rq2_words_number = dplyr::row_number())%>%
  dplyr::relocate(rq2_words_number, .after = word_number) %>%
  select(-word_number)

# zostwiamy tylko te zmienne, które nas interesują
words_rq2 <- words_rq2 %>%
  filter(rq2_words_number == 1 | rq2_words_number == 10 | rq2_words_number == 50) %>%
  dplyr::select(c(child_anonim, name, rq2_words_number, age_at_element, language_new))

words_rq2 <- words_rq2 %>% dplyr::select(-name)
words_rq2$word_number[words_rq2$rq2_words_number == 1] <- "w1"
words_rq2$word_number[words_rq2$rq2_words_number == 10] <- "w10"
words_rq2$word_number[words_rq2$rq2_words_number == 50] <- "w50"

words_rq2 <- words_rq2 %>% rename("milestone" = word_number)

words_rq2 <- words_rq2 %>% select(c(child_anonim, milestone, age_at_element, language_new))

```


```{r multiwordsrq2}
# -------------- MULTIWORDS FOR RQ2 -------------
# we duplicate a rowx times ; x = how many languages the multiword is reported in
# e.g. Polish+English multiword --> shown in data twice (once as PL, once as ENG)

multiwords_longer <- multiwords %>% 
  arrange(child_anonim) %>%
  select(-c(m_cat)) %>%
  pivot_longer(cols = c("l1", "l2", "l3"),
               names_to = "language_nr",
               values_to = "language_name") %>%
  filter(!is.na(language_name)) %>%
  relocate(language_name, .after = meaning) %>%
  relocate(language_nr, .after = meaning)

multiwords_longer <- multiwords_longer %>%
  mutate(
    language_new = dplyr::if_else(language_name == "Polish", "HL", "ML")) %>%
  dplyr::relocate(language_new, .after = language_name) %>% unique()

multiwords_rq2 <- multiwords_longer %>% 
  arrange(elements_number) %>%
  group_by(child_anonim, language_new, words_per_utterance) %>%
  mutate(rq2_elements_number = dplyr::row_number()) %>%
  dplyr::relocate(rq2_elements_number, .before = words_per_utterance)

# order by elements_number (ordinal number of element based on occurence date), and for each child and each language (PL, L2) find 1st utterance and assign it "m1"
# order by elements_number, and for each child and each language (PL, L2) find 1st utterance where words_per_utterance == 3 and assign "m3"
# order by elements_number, and for each child and each language (PL, L2) find 1st utterance where words_per_utterance == 4 and assign "m4"

m1 <- multiwords_rq2 %>%
  group_by(child_anonim, language_new) %>%
  arrange(rq2_elements_number) %>%
  filter(dplyr::row_number() == 1) %>%
  mutate(m_cat = "m1") %>%
  dplyr::select(child_anonim, m_cat, age_at_element, language_new)

m3 <- multiwords_rq2 %>%
  group_by(child_anonim, language_new) %>%
  arrange(rq2_elements_number) %>%
  filter(words_per_utterance == 3) %>%
  filter(dplyr::row_number() == 1) %>%
  mutate(m_cat = "m3")%>%
  dplyr::select(child_anonim, m_cat, age_at_element, language_new)

m4 <- multiwords_rq2 %>%
  group_by(child_anonim, language_new) %>%
  arrange(rq2_elements_number) %>%
  filter(words_per_utterance == 4) %>%
  filter(dplyr::row_number() == 1) %>%
  mutate(m_cat = "m4")%>%
  dplyr::select(child_anonim, m_cat, age_at_element, language_new)

multiwords_rq2 <- rbind(m1, m3, m4)

multiwords_rq2 <- multiwords_rq2 %>% rename("milestone" = m_cat)
```

```{r rq2 and _longer}

rq2_longer <- rbind(words_rq2, multiwords_rq2)

rq2 <- rq2_longer %>%
  pivot_wider(names_from = c(milestone), values_from = age_at_element)

```

#### All bilinguals

```{r, include = T, echo=FALSE, warning=FALSE}
# we take only the vars we want for RQ2
lineplot_rq2 <- rq2

# for each milestone, we want to include only children who have info from both languages
# we will create seperate dfs for each milestone (filter out incomplete observations)
# and then rbind these separate dfs into one, to draw a plot upon it.

# w1
rq2_w1 <- rq2 %>%
  dplyr::select("child_anonim", "language_new", "w1") %>%
  pivot_wider(names_from = language_new, values_from = w1) %>%
  filter(complete.cases(HL, ML)) %>%
  pivot_longer(cols = c(HL, ML), names_to = "language_new", values_to = "age_at_element") %>%
  mutate(milestone = "w1") %>% dplyr::relocate(milestone, .before = child_anonim)

rq2_w1_se <- rq2_w1 %>%
  summarySE(measurevar = "age_at_element", groupvars = c("language_new"), na.rm = T) %>%
  mutate(milestone = "w1") %>% dplyr::relocate(milestone, .before = language_new)

#w10
rq2_w10 <- rq2 %>%
  dplyr::select("child_anonim", "language_new", "w10") %>%
  pivot_wider(names_from = language_new, values_from = w10) %>%
  filter(complete.cases(HL, ML)) %>%
  pivot_longer(cols = c(HL, ML), names_to = "language_new", values_to = "age_at_element") %>%
  mutate(milestone = "w10") %>% dplyr::relocate(milestone, .before = child_anonim)
rq2_w10_se <- rq2_w10 %>%
  summarySE(measurevar = "age_at_element", groupvars = c("language_new"), na.rm = T) %>%
  mutate(milestone = "w10") %>% dplyr::relocate(milestone, .before = language_new)

#w50
#none
rq2_w50 <- rq2 %>%
  dplyr::select("child_anonim", "language_new", "w50") %>%
  pivot_wider(names_from = language_new, values_from = w50) %>%
  filter(complete.cases(HL, ML)) %>%
  pivot_longer(cols = c(HL, ML), names_to = "language_new", values_to = "age_at_element") %>%
  mutate(milestone = "w50") %>% dplyr::relocate(milestone, .before = child_anonim)
# no data for summarySE

#m1
rq2_m1 <- rq2 %>%
  dplyr::select("child_anonim", "language_new", "m1") %>%
  pivot_wider(names_from = language_new, values_from = m1) %>%
  filter(complete.cases(HL, ML)) %>%
  pivot_longer(cols = c(HL, ML), names_to = "language_new", values_to = "age_at_element") %>%
  mutate(milestone = "m1") %>% dplyr::relocate(milestone, .before = child_anonim)
rq2_m1_se <- rq2_m1 %>%
  summarySE(measurevar = "age_at_element", groupvars = c("language_new"), na.rm = T) %>%
  mutate(milestone = "m1") %>% dplyr::relocate(milestone, .before = language_new)

#m3
rq2_m3 <- rq2 %>%
  dplyr::select("child_anonim", "language_new", "m3") %>%
  pivot_wider(names_from = language_new, values_from = m3) %>%
  filter(complete.cases(HL, ML)) %>%
  pivot_longer(cols = c(HL, ML), names_to = "language_new", values_to = "age_at_element") %>%
  mutate(milestone = "m3") %>% dplyr::relocate(milestone, .before = child_anonim)
rq2_m3_se <- rq2_m3 %>%
  summarySE(measurevar = "age_at_element", groupvars = c("language_new"), na.rm = T) %>%
  mutate(milestone = "m3") %>% dplyr::relocate(milestone, .before = language_new)

#m4
# none
rq2_m4 <- rq2 %>%
  dplyr::select("child_anonim", "language_new", "m4") %>%
  pivot_wider(names_from = language_new, values_from = m4) %>%
  filter(complete.cases(HL, ML)) %>%
  pivot_longer(cols = c(HL, ML), names_to = "language_new", values_to = "age_at_element") %>%
  mutate(milestone = "m4") %>% dplyr::relocate(milestone, .before = child_anonim)
# no data for summarySE

# note: no child had w50 or m4 for both languages, we add an empty rows to have these milestones on the plot
new_row1 <- list(milestone = "w50", language_new="HL", N = 0, age_at_element = NA, sd = NA, se = NA, ci = NA)
new_row1 <- as.data.frame(new_row1)
new_row2 <- list(milestone = "w50", language_new="ML", N = 0, age_at_element = NA, sd = NA, se = NA, ci = NA)
new_row2 <- as.data.frame(new_row2)
new_row3 <- list(milestone = "m4", language_new="HL", N = 0, age_at_element = NA, sd = NA, se = NA, ci = NA)
new_row3 <- as.data.frame(new_row3)
new_row4 <- list(milestone = "m4", language_new="ML", N = 0, age_at_element = NA, sd = NA, se = NA, ci = NA)
new_row4 <- as.data.frame(new_row4)
rq2_m4_se <- rbind(new_row1, new_row2, new_row3, new_row4)
# rbind
lineplot_sum_rq2 <- rbind(rq2_w1_se, rq2_w10_se, new_row1, new_row2, rq2_m1_se, rq2_m3_se, new_row3, new_row4)

```

```{r w1 outliers}
# view the data for potential outliers
rq2_w1 %>% ggplot(aes(x = language_new, y = age_at_element)) + geom_boxplot() + geom_jitter()

# identify outliers (rstatix::identify...)
rq2_w1 %>%
  dplyr::group_by(language_new) %>% 
  identify_outliers("age_at_element")


```

```{r w10 outliers}
# view the data for potential outliers
rq2_w10 %>% ggplot(aes(x = language_new, y = age_at_element)) + geom_boxplot() + geom_jitter()

# identify outliers (rstatix::identify...)
rq2_w10 %>%
  dplyr::group_by(language_new) %>% 
  identify_outliers("age_at_element")

```


#### Table 4 - descriptive stats
```{r, include = T, echo=FALSE, warning=FALSE}
lineplot_rq2 <- rbind(rq2_w1, rq2_w10, rq2_w50, rq2_m1, rq2_m3, rq2_m4)
lineplot_rq2_l <- lineplot_rq2 %>% pivot_wider(id_cols = c(child_anonim, language_new), names_from = milestone, values_from = age_at_element)

lineplot_rq2_l$language_new <- ordered(lineplot_rq2_l$language_new , c("HL", "ML"))

lineplot_rq2_l %>%
  group_by(language_new) %>%
  summarise(
    "w1 n" = sum(!is.na(w1)),
    "w1 Age (M) " = specify_decimal(mean(w1, na.rm = T),2),
    "w1 Age (SD) " = specify_decimal(sd(w1, na.rm = T),2),
    "w10 n" = sum(!is.na(w10)),
    "w10 Age (M) " = specify_decimal(mean(w10, na.rm = T),2),
    "w10 Age (SD) " = specify_decimal(sd(w10, na.rm = T),2),
    "m1 n" = sum(!is.na(m1)),
    "m1 Age (M) " = specify_decimal(mean(m1, na.rm = T),2),
    "m1 Age (SD) " = specify_decimal(sd(m1, na.rm = T),2),
    "m3 n" = sum(!is.na(m3)),
    "m3 Age (M) " = specify_decimal(mean(m3, na.rm = T),2),
    "m3 Age (SD) " = specify_decimal(sd(m3, na.rm = T),2),
    .groups = "keep") %>%
  kable("html") %>% kable_styling()
```


#### Figure 2
```{r figure2, include = T, echo=FALSE, warning=FALSE}
# Figure 2 - data from all bilinguals (with various majority languages)

lineplot_sum_rq2$milestone
lineplot_sum_rq2$milestone <- ordered(lineplot_sum_rq2$milestone , c("w1", "w10", "w50", "m1", "m3", "m4"))
lineplot_sum_rq2$language_new <- ordered(lineplot_sum_rq2$language_new , c("HL", "ML"))


lineplot_sum_rq2 <- as.data.frame(lineplot_sum_rq2)

fig2 <- ggplot(lineplot_sum_rq2, aes(x=milestone, y=age_at_element, group=language_new, color=language_new)) + 
  geom_line(aes(linetype=language_new)) +
  geom_point(position=position_dodge(0.03)) +
  geom_errorbar(aes(ymin=age_at_element-ci, ymax=age_at_element+ci),
                width=0.5, 
                position=position_dodge(0.03)) +
  scale_y_continuous(limits = c(4,28), breaks = c(4,6,8,10, 12, 14, 16, 18, 20, 22, 24, 26, 28)) +
  scale_x_discrete(labels = c("1st word \n n = 86",
                              "10th word \n n = 15",
                              "50th word \n n = 0",
                              "1st multiword \n n = 7",
                              "3-word utt. \n n = 1",
                              "4-word utt. \n n = 0")) +
  scale_color_brewer(type = "qual", palette = 2, labels = c("Home language (Polish)", "Majority language")) +
  scale_linetype_manual(values = c("solid", "dashed"), labels = c("Home language (Polish)", "Majority language")) +
  ylab("Age at reaching milestone") + xlab("") +
  labs(title = "Parental report", caption = "Error bars indicate 95% CI") +
  theme(legend.position = "bottom",
        legend.title = element_blank(),
        panel.background = element_rect(fill = "white", colour = "white", linetype = "solid"),
        panel.grid.major = element_line(linetype = "solid", colour = "grey90"))

fig2
ggsave("fig2.jpeg", dpi = 250, width = 1700, height = 1000, units = "px")


```

##### Figure 2 alternative

[x] maybe remove linetype by group and make both lines grey/dotted (and add transparency) to not suggest (so much) the longitudinal aspect of the plot? I don't think removing the lines altogether is a good option, especially since for some (few) children this is longitudinal data.
[x] larger breaks on the y axis? maybe by 6 months? --> MK: did 4 months

```{r}
# Figure 2 - data from all bilinguals (with various majority languages)

lineplot_sum_rq2$milestone
lineplot_sum_rq2$milestone <- ordered(lineplot_sum_rq2$milestone , c("w1", "w10", "w50", "m1", "m3", "m4"))
lineplot_sum_rq2$language_new <- ordered(lineplot_sum_rq2$language_new , c("HL", "ML"))


lineplot_sum_rq2 <- as.data.frame(lineplot_sum_rq2)

fig2_alternative <- ggplot(lineplot_sum_rq2, aes(x=milestone, y=age_at_element, group=language_new, color=language_new)) + 
  geom_line(linetype = 2, color = "black", alpha = .3) + #remove coloring by group and alpha
  geom_point(position=position_dodge(0.03)) +
  geom_errorbar(aes(ymin=age_at_element-ci, ymax=age_at_element+ci),
                width=0.5, 
                position=position_dodge(0.03)) +
  scale_y_continuous(limits = c(4,28), breaks = c(4, 8, 12, 16, 20, 24, 28)) +
  scale_x_discrete(labels = c("w1" = "1st word \n n = 86",
                              "w10" = "10th word \n n = 15",
                              "w50" = "50th word \n n = 0",
                              "m1" = "1st multiword \n n = 7",
                              "m3" = "3-word utt. \n n = 1",
                              "m4"  = "4-word utt. \n n = 0")) +
  scale_color_brewer(type = "qual", palette = 2, labels = c("Home language (Polish)", "Majority language")) +
  scale_linetype_manual(values = c("solid", "dashed"), labels = c("Home language (Polish)", "Majority language")) +
  ylab("Age at reaching milestone") + xlab("") +
  labs(title = "Parental report", caption = "Error bars indicate 95% CI") +
  theme(legend.position = "bottom",
        legend.title = element_blank(),
        plot.caption = element_text(hjust = 0), #caption to the left
        panel.background = element_rect(fill = "white", colour = "white", linetype = "solid"),
        panel.grid.major = element_line(linetype = "solid", colour = "grey90"))

fig2_alternative
ggsave("fig2_alternative.jpeg", dpi = 250, width = 1700, height = 1000, units = "px")
```


#### RQ2: t-test
```{r all_bi_ttest, include = T, echo=FALSE, warning=FALSE}

leveneTest(age_at_element ~ language_new, data = rq2_w1)
leveneTest(age_at_element ~ language_new, data = rq2_w10)

# rbind for t-test with holm correction
rq2_analysis <- rbind(rq2_w1, rq2_w10)
rq2_analysis$milestone <- factor(rq2_analysis$milestone, ordered = T, levels = c("w1", "w10"))

# t-test
rq2_analysis %>%
  dplyr::group_by(milestone) %>%
  rstatix::t_test(age_at_element ~ language_new, paired = T, var.equal = T, conf.level = 0.95, detailed = T) %>%
  adjust_pvalue(method = "holm") %>%
  add_significance("p.adj") %>%
  kable("html") %>% kable_styling()

```

#### RQ2: Bayes Factors

#### Word1
```{r, include = T, echo= T, warning=FALSE}
# w1
prebf_df <- rq2_w1
prepbf <-  lm(age_at_element~language_new-1, data=prebf_df)
coef(prepbf)
set.seed(100)
resbf<-bain(prepbf,"language_newHL = language_newML")
print(resbf)

# Sensitivity Analysis
# compute BF01 using b-g (same BF as printed above)
resbf_sa<-bain(prepbf,"language_newHL = language_newML", fraction = 1)
print(resbf_sa)
# compute BF01 replacing b-g by 2 x b-g
# setting fraction to 2 implies using 2 x b-g
set.seed(100)
resbf_sa<-bain(prepbf,"language_newHL = language_newML", fraction = 2)
print(resbf_sa)
# compute BF01 replacing b-g by 3 x b-g
set.seed(100)
resbf_sa<-bain(prepbf,"language_newHL = language_newML", fraction = 3)
print(resbf_sa)
```

#### Word10
```{r, include = T, echo= T, warning=FALSE}
# w10
prebf_df <- rq2_w10
prepbf <-  lm(age_at_element~language_new-1, data=prebf_df)
coef(prepbf)
set.seed(100)
resbf<-bain(prepbf,"language_newHL = language_newML")
print(resbf)

# Sensitivity Analysis
# compute BF01 using b-g (same BF as printed above)
set.seed(100)
resbf_sa<-bain(prepbf,"language_newHL = language_newML", fraction = 1)
print(resbf_sa)
# compute BF01 replacing b-g by 2 x b-g
set.seed(100)
# setting fraction to 2 implies using 2 x b-g
resbf_sa<-bain(prepbf,"language_newHL = language_newML", fraction = 2)
print(resbf_sa)
# compute BF01 replacing b-g by 3 x b-g
set.seed(100)
# setting fraction to 2 implies using 2 x b-g
resbf_sa<-bain(prepbf,"language_newHL = language_newML", fraction = 3)
print(resbf_sa)
```

#### Multiword1
```{r, include = T, echo= T, warning=FALSE}
# m1
prebf_df <- rq2_m1
prepbf <-  lm(age_at_element~language_new-1, data=prebf_df)
coef(prepbf)
set.seed(100)
resbf<-bain(prepbf,"language_newHL = language_newML")
print(resbf)

# Sensitivity Analysis
# compute BF01 using b-g (same BF as printed above)
set.seed(100)
resbf_sa<-bain(prepbf,"language_newHL = language_newML", fraction = 1)
print(resbf_sa)
# compute BF01 replacing b-g by 2 x b-g
set.seed(100)
# setting fraction to 2 implies using 2 x b-g
resbf_sa<-bain(prepbf,"language_newHL = language_newML", fraction = 2)
print(resbf_sa)
# compute BF01 replacing b-g by 3 x b-g
set.seed(100)
# setting fraction to 2 implies using 2 x b-g
resbf_sa<-bain(prepbf,"language_newHL = language_newML", fraction = 3)
print(resbf_sa)

```


### Appendix A
```{r, include = T, echo=FALSE, warning=FALSE}
input <- read.csv2("input.csv")

input <- merge(input, kids[,c("child_anonim", "country")], all.x = T)

input <- input %>%
  dplyr::select("child_anonim", "group", "country", "home_input")

input <- input %>% mutate(country_collapsed = case_when(
  country == "UK" ~ "UK",
  country == "NORWAY" ~ "NORWAY",
  TRUE ~ "OTHER"
))

input$home_input <- factor(input$home_input, levels = c("noInfo", "mixed", "polish"))
input$country_collapsed <- factor(input$country_collapsed, levels = c("UK", "NORWAY", "OTHER"))

input_sum <- input %>%
  group_by(country_collapsed, home_input) %>%
  dplyr::summarise(n = length(child_anonim))

input_sum <- input_sum %>% dplyr::group_by(country_collapsed) %>% mutate(percentage=100*n/sum(n))
input_sum$percentage <- round(input_sum$percentage, digits = 0)

input_sum$home_input <- dplyr::recode_factor(input_sum$home_input, noInfo = "No Information", mixed = "Mixed", polish = "Polish only")

input_sum %>%
  ggplot(aes(y = percentage, x = country_collapsed, fill = home_input)) +
  geom_bar(stat="identity") + 
  geom_text(aes(x = country_collapsed, y = percentage, label = paste0(percentage,"%")), size=4,
            position = position_stack(vjust = 0.5)) +
  scale_x_discrete(labels = c("Polish-English \n bilinguals", "Polish-Norwegian \n bilinguals", "Polish-Other \n bilinguals")) +
  xlab("") + ylab("Percentage") +
  scale_fill_manual(values = c("#EBEDF3", "#c6ccdd", "#6699CC")) +
                      theme(legend.title = element_blank(), panel.background = element_rect(fill = "white", colour = "grey50"))

ggsave("figA1.jpeg", height = 1400, units = "px", dpi = 300)

```

### Input hours
```{r}
input_hrs <- read.csv2("input_hrs.csv")
input_hrs <- input_hrs %>% select(child_anonim, question_id, language, answer, typical)
input_hrs$language <- fct_recode(input_hrs$language, HL = "PL", ML = "L2")
input_hrs <- input_hrs %>% rename(input_hours_previous_day = "answer")
input_hrs$input_hours_previous_day <- as.numeric(input_hrs$input_hours_previous_day)

input_hrs <- input_hrs %>%
   group_by(child_anonim, language) %>% 
   summarise_at(vars(input_hours_previous_day), mean)

input_hrs <- merge(input_hrs, rq2, by.x = c("child_anonim", "language"),
                   by.y = c("child_anonim", "language_new"))


input_hrs_long <- input_hrs %>%
  select(child_anonim:m1) %>%
  pivot_longer(cols = w1:m1, names_to = "milestone", values_to = "age_at_element")

library(ggpubr)
input_hrs_long %>%
  ggplot(aes(x = age_at_element, y = input_hours_previous_day, group = language, color = language)) +
  geom_point() +
  geom_smooth(method = "lm") +
  facet_wrap(~milestone) +
  stat_cor(method = "spearman",
           cor.coef.name = "rho",
           p.accuracy = 0.001,
           r.accuracy = 0.01, show.legend = F)

```

### Input percentage (HL)
```{r}
input_perc <- input_hrs %>%
  select(child_anonim, language, input_hours_previous_day) %>%
  pivot_wider(id_cols = c(child_anonim),
              names_from = language,
              values_from = input_hours_previous_day)

input_perc <- input_perc %>%
  rowwise() %>%
  mutate(input_sum_hrs = sum(HL,ML, na.rm = T),
    input_perc_HL = (HL/(input_sum_hrs))*100)

input_perc <- input_perc %>%
  mutate(input_perc_HL = ifelse(is.na(input_perc_HL), 0,input_perc_HL)) #if NA in input_perc_HL, replace with zero

# descriptives - hours
mean(input_perc$input_sum_hrs, na.rm = T)
median(input_perc$input_sum_hrs, na.rm = T)
sd(input_perc$input_sum_hrs, na.rm = T)

# descriptives - %
mean(input_perc$input_perc_HL, na.rm = T)
median(input_perc$input_perc_HL, na.rm = T)
sd(input_perc$input_perc_HL, na.rm = T)
hist(input_perc$input_perc_HL)

# long df
input_perc_long <- input_perc %>%
  pivot_longer(cols = HL:ML, names_to = "language", values_to = "input_hrs")

input_perc_long <- merge(input_perc_long, rq2, by.x = c("child_anonim", "language"),
                   by.y = c("child_anonim", "language_new"))

input_perc_longer <- input_perc_long %>%
  select(child_anonim:m1) %>%
  pivot_longer(cols = w1:m1, names_to = "milestone", values_to = "age_at_element")

input_perc_longer %>%
  ggplot(aes(x = age_at_element, y = input_perc_HL, group = language, color = language)) +
  geom_point() +
  geom_smooth(method = "lm") +
  facet_wrap(~milestone) +
  stat_cor(method = "spearman",
           cor.coef.name = "rho",
           p.accuracy = 0.001,
           r.accuracy = 0.01, show.legend = F)

```
### Input corr
```{r}
# Home language

input_HL <- input_perc_long %>% filter(language == "HL")

hist(input_HL$input_perc_HL)
hist(input_HL$w1)

cor.test(input_HL$input_perc_HL, input_HL$w1, method = "spearman")
cor.test(input_HL$input_perc_HL, input_HL$w10, method = "spearman")
cor.test(input_HL$input_perc_HL, input_HL$m1, method = "spearman")

library(BayesFactor)
citation("BayesFactor")
bf = correlationBF(input_HL$input_perc_HL, input_HL$w1)
bf
1/bf

samples = posterior(bf, iterations = 10000)
summary(samples)


bf = correlationBF(input_HL$input_perc_HL, input_HL$w10)
bf
1/bf

samples = posterior(bf, iterations = 10000)
summary(samples)


bf = correlationBF(input_HL$input_perc_HL, input_HL$m1)
bf
1/bf

samples = posterior(bf, iterations = 10000)
summary(samples)
```


```{r}
# Majority language

input_ML <- input_perc_long %>% filter(language == "ML")

hist(input_ML$input_perc_HL)
hist(input_ML$w1)

cor.test(input_ML$input_perc_HL, input_ML$w1, method = "spearman")
cor.test(input_ML$input_perc_HL, input_ML$w10, method = "spearman")


bf = correlationBF(input_ML$input_perc_HL, input_ML$w1)
bf
1/bf

samples = posterior(bf, iterations = 10000)
summary(samples)


bf = correlationBF(input_ML$input_perc_HL, input_ML$w10)
bf
1/bf

samples = posterior(bf, iterations = 10000)
summary(samples)
```


### Input lineplot
```{r}
input_perc_long %>%
  ggplot(aes(x = input_perc_HL)) + geom_histogram()

input_perc_long <- input_perc_long %>%
  mutate(input_group = case_when(
    input_perc_HL == 50 ~ "balanced",
    input_perc_HL < 50 ~ "less_HL",
    input_perc_HL > 50 ~ "more_HL",
    .default = NA
  ))

input_perc_long$input_group <- factor(input_perc_long$input_group,
                                      levels = c("less_HL", "balanced","more_HL"))

input_perc_long %>% ggplot(aes(x = language, y = w1, color = language))+
  geom_point() +
  facet_wrap(~input_group)

input_perc_long %>% 
  ggplot(aes(x = language, y = w1, color = language, group = child_anonim))+
  geom_point(alpha = 0.6) + geom_line(linetype = "dashed", color = "#636363") +
  facet_wrap(~input_group) + theme_light()

input_perc_long %>% 
  ggplot(aes(x = language, y = w10, color = language, group = child_anonim))+
  geom_point() + geom_line(linetype = "dashed", color = "grey") +
  facet_wrap(~input_group) + theme_light()

input_perc_long %>% 
  ggplot(aes(x = language, y = m1, color = language, group = child_anonim))+
  geom_point() + geom_line(linetype = "dashed", color = "grey") +
  facet_wrap(~input_group) + theme_light()

```

### Input plot
```{r}

input_perc_long %>% select(child_anonim) %>% unique()

input_perc_sum <- input_perc_long %>% pivot_longer(cols = w1:m4,
                                                   names_to = "milestone",
                                                   values_to = "age_at_element")
  
input_perc_sum <- input_perc_sum %>%
  summarySE(measurevar = "age_at_element",
            groupvars = c("language", "milestone", "input_group"),
            na.rm = T)

input_perc_sum$milestone
input_perc_sum$milestone <- ordered(input_perc_sum$milestone , c("w1", "w10", "w50", "m1", "m3", "m4"))
input_perc_sum$language <- ordered(input_perc_sum$language , c("HL", "ML"))
input_perc_sum$input_group <- ordered(input_perc_sum$input_group, c("less_HL", "balanced", "more_HL"))

input_perc_sum %>%
  ggplot(aes(x=milestone, y=age_at_element, color=input_group)) +
  geom_point(position=position_dodge(0.4)) +
  geom_errorbar(aes(ymin=age_at_element-ci, ymax=age_at_element+ci),
                width=0.5, 
                position=position_dodge(0.4)) +
  scale_y_continuous(limits = c(0,48), breaks = c(0, 6, 12, 18, 24, 30, 36, 42, 48)) +
  scale_x_discrete(labels = c("1st word",
                              "10th word",
                              "50th word",
                              "1st multiword",
                              "3-word utt.",
                              "4-word utt.")) +
  scale_color_brewer(type = "qual", palette = 2) +
  ylab("Age at reaching milestone") + xlab("")+
  labs(caption = "Error bars indicate 95% CI")+
  theme(legend.position = "bottom",
        legend.title = element_blank(),
        panel.background = element_rect(fill = "white", colour = "white", linetype = "solid"),
        panel.grid.major = element_line(linetype = "solid", colour = "grey90")) +
  facet_wrap(~language)


ggsave("fig3.jpeg", dpi = 250, width = 2200, height = 1000, units = "px")


```


### Appendix B
Here we're following the analyses for RQ1 (bilinguals vs. monolinguals) but for three groups: one group of bilingual children and TWO DISTINCT matched groups of monolingual children.

```{r Supp Table A1}
table_B1 <- kids %>%
  group_by(group) %>%
  summarise(n = dplyr::n(),
            "Entry age (M)" = mean(age_at_study_entry),
            "Entry age (SD)" = sd(age_at_study_entry),
            "Days reporting (M)" = mean(days_reporting, na.rm = T),
            "Days reporting (SD)" = sd(days_reporting, na.rm = T),
            "Days reporting (min)" = min(days_reporting, na.rm = T),
            "Days reporting (max)" = max(days_reporting, na.rm = T),
            .groups = "keep")

table_B1 <- nice_table(table_B1)
table_B1

```


```{r Supp Words}

# words for Appendix B (B1)

words_B1 <- words %>%
  filter(word_number == 1 | word_number == 10 | word_number == 50) %>%
  select(c(child_anonim, group, match, word_number, age_at_element))

words_B1_wider <- words_B1 %>%
  pivot_wider(id_cols = child_anonim, names_from = word_number, values_from = age_at_element) %>%
  rename("w1" = "1", "w10" = "10", "w50" = "50")

```

```{r Supp Multiwords}

#  multiwords for Appendix B (B1)
multiwords_B1 <- multiwords %>%
  filter(!is.na(m_cat)) %>%
  pivot_wider(id_cols = c(child_anonim, group, match), names_from = m_cat, values_from = age_at_element,
              values_fill = NA) %>% unnest()


```

```{r}
# add milestones
milestones_B1 <- milestones

# merge words, mulytiwords and milestones into one data frame
all_B1 <- merge(milestones_B1, words_B1_wider, by = "child_anonim", all = T)
all_B1 <- merge(all_B1, multiwords_B1[,c("child_anonim", "m1", "m3", "m4")], by = "child_anonim", all = T)

```


```{r}

# wide to long
lineplot_B_longer <- all_B1 %>%
  pivot_longer(cols = 4:12, names_to = "milestone", values_to = "age_at_element")

lineplot_B_longer <- lineplot_B_longer %>% unique()

lineplot_B_longer$milestone <- factor(lineplot_B_longer$milestone, ordered = T, levels = c("crawling_age", "babbling_age", "walking_age","w1", "w10", "w50", "m1", "m3", "m4"))

```


```{r App.B outliers}
# view the data for potential outliers
lineplot_B_longer %>% ggplot(aes(x = milestone, y = age_at_element, fill = group)) + geom_boxplot() + geom_jitter() +
  theme(legend.position = "bottom")

# identify outliers (rstatix::identify...)
B_outliers <- lineplot_B_longer %>%
  dplyr::group_by(group, milestone) %>% 
  identify_outliers("age_at_element")

# mark outliers in the dataset and filter out
lineplot_B_longer <- merge(lineplot_B_longer, B_outliers[, c("child_anonim", "milestone", "is.outlier")], all.x = T)

lineplot_B_longer <- lineplot_B_longer %>% filter(is.na(is.outlier))

```


#### Figure B1
```{r Figure A1, include = T, echo=FALSE, warning=FALSE}

lineplot_B_sum <- summarySE(lineplot_B_longer, measurevar = "age_at_element", groupvars = c("milestone", "group"), na.rm = T)
lineplot_B_sum$milestone <- as.factor(lineplot_B_sum$milestone)

lineplot_B_sum <- lineplot_B_sum %>%
  mutate(source = dplyr::case_when(
    milestone == "babbling_age" ~ "parental recall",
    milestone == "crawling_age" ~ "parental recall",
    milestone == "walking_age" ~ "parental recall",
    TRUE ~ "parental report",
  ))


figBa <- lineplot_B_sum %>%
  filter(source == "parental recall") %>%
  ggplot(aes(x=milestone, y=age_at_element, group=group, color=group)) + 
  geom_line(aes(linetype=group)) +
  geom_point(position=position_dodge(0.03)) +
  geom_errorbar(aes(ymin=age_at_element-ci, ymax=age_at_element+ci),
                width=0.5, 
                position=position_dodge(0.03)) +
  scale_y_continuous(limits = c(4,28), breaks = c(4, 6, 8, 10, 12, 14, 16, 18, 20, 22, 24, 26, 28)) +
  scale_x_discrete(labels = c("Crawling \n B n = 77 \n M1 n = 74 \n M2 n = 78",
                              "Babbling \n B n = 58 \n M1 n = 54 \n M2 n = 54",
                              "Walking \n B n = 49 \n M1 n = 43 \n M2 n = 42")) +
  scale_color_brewer(type = "qual", palette = 6) +
  labs(title = "Parental report/recall") +
  ylab("Age at reaching milestone") + xlab("") +
  theme(legend.position = "bottom",
        legend.title = element_blank(),
        panel.background = element_rect(fill = "white", colour = "white", linetype = "solid"),
        panel.grid.major = element_line(linetype = "solid", colour = "grey90"))


figBb <- lineplot_B_sum %>%
  filter(source == "parental report") %>%
  ggplot(aes(x=milestone, y=age_at_element, group=group, color=group)) + 
  geom_line(aes(linetype=group)) +
  geom_point(position=position_dodge(0.03)) +
  geom_errorbar(aes(ymin=age_at_element-ci, ymax=age_at_element+ci),
                width=0.5, 
                position=position_dodge(0.03)) +
  scale_y_continuous(limits = c(4,28), breaks = c(4, 6, 8, 10, 12, 14, 16, 18, 20, 22, 24, 26, 28)) +
  scale_x_discrete(labels = c("1st word \n B n = 140 \n M1 n = 137 \n M2 n = 137",
                              "10th word  \n B n = 50 \n M1 n = 47 \n M2 n = 49",
                              "50th word  \n B n = 15 \n M1 n = 14 \n M2 n = 8",
                              "1st multiword \n B n = 34 \n M1 n = 41 \n M2 n = 31",
                              "3-word utt. \n B n = 14 \n M1 n = 18 \n M2 n = 16",
                              "4-word utt. \n B n = 3 \n M1 n = 6 \n M2 n = 5")) +
  scale_color_brewer(type = "qual", palette = 6) +
  ylab("Age at reaching milestone") + xlab("") +
  labs(title = "Parental report") +
  theme(legend.position = "bottom",
        legend.title = element_blank(),
        panel.background = element_rect(fill = "white", colour = "white", linetype = "solid"),
        panel.grid.major = element_line(linetype = "solid", colour = "grey90"))

title <- ggdraw() + 
  draw_label("Error bars indicate 95% CI", size = 9, hjust = 1) +
  theme(
    # add margin on the left of the drawing canvas,
    # so title is aligned with left edge of first plot
    plot.margin = margin(0, 0, 0, 50))

plot_grid(figBa, figBb, title, align = "h",  rel_widths = c(1,2), rel_heights = c(1, .1))
ggsave("figB1.jpeg", dpi = 250, width = 2100, height = 1000, units = "px")

```

##### Figure B1 alternative

Issue #1
[x] remove crawling and walking but keep babbling in
[x] remove the two facets (panels) and merge into a single plot (and remove caption/title on top)
[x] maybe remove linetype by group and make both lines grey/dotted (and add transparency) to not suggest (so much) the longitudinal aspect of the plot? I don't think removing the lines altogether is a good option, especially since for some (few) children this is longitudinal data.
[x] larger breaks on the y axis? maybe by 6 months? --> MK: did 4 months

```{r}
#filter crawling and walking but keep babbling in 
lineplot_B_longer_filtered <- lineplot_B_longer %>%
  filter(milestone != "crawling_age" & milestone != "walking_age")
#drop unused levels
lineplot_B_longer_filtered$milestone <- fct_drop(lineplot_B_longer_filtered$milestone)
#check
table(lineplot_B_longer_filtered$milestone)
#summary
lineplot_B_sum_filtered <- summarySE(lineplot_B_longer_filtered, measurevar = "age_at_element", groupvars = c("milestone", "group"), na.rm = T)
lineplot_B_sum_filtered$milestone <- as.factor(lineplot_B_sum_filtered$milestone)

figB_alternative <- lineplot_B_sum_filtered %>%
  ggplot(aes(x=milestone, y=age_at_element, group=group, color=group)) + 
  geom_line(linetype = 2, color = "black", alpha = .3) +
  geom_point(position=position_dodge(0.03)) +
  geom_errorbar(aes(ymin=age_at_element-ci, ymax=age_at_element+ci),
                width=0.5, 
                position=position_dodge(0.03)) +
  scale_y_continuous(limits = c(4,28), breaks = c(4, 8, 12, 16, 20, 24, 28)) + 
  scale_x_discrete(labels = c("babbling_age" = "Babbling \n B n = 58 \n M1 n = 54 \n M2 n = 54",
                              "w1" = "1st word \n B n = 140 \n M1 n = 137 \n M2 n = 137",
                              "w10" = "10th word  \n B n = 50 \n M1 n = 47 \n M2 n = 49",
                              "w50" = "50th word  \n B n = 15 \n M1 n = 14 \n M2 n = 8",
                              "m1" = "1st multiword \n B n = 34 \n M1 n = 41 \n M2 n = 31",
                               "m3" = "3-word utt. \n B n = 14 \n M1 n = 18 \n M2 n = 16",
                              "m4" = "4-word utt. \n B n = 3 \n M1 n = 6 \n M2 n = 5")) +
  scale_color_brewer(type = "qual", palette = 6) +
  ylab("Age at reaching milestone") + xlab("") +
labs(y ="Age at reaching milestone", x = NULL,
       caption = "Error bars indicate 95% CI")  +
  theme(legend.position = "bottom",
        legend.title = element_blank(),
        plot.caption = element_text(hjust = 0),
        panel.background = element_rect(fill = "white", colour = "white", linetype = "solid"),
        panel.grid.major = element_line(linetype = "solid", colour = "grey90"))

figB_alternative

ggsave("figB1_alternative.jpeg", dpi = 250, width = 2100, height = 1000, units = "px")
```

#### Table B3
```{r Table A3, include = T, echo = F, warning = F}

specify_decimal <- function(x, k) trimws(format(round(x, k), nsmall=k))

lineplot_B_longer %>%
  filter(!is.na(group)) %>%
  group_by(milestone, group) %>%
  summarise(
  "n" = sum(!is.na(age_at_element)),
  "Age (M)" = specify_decimal(mean(age_at_element, na.rm = T),2),
  "Age (SD)" = specify_decimal(sd(age_at_element, na.rm = T),2)) %>%
  kable("html") %>% kable_styling()

```


#### Appendix B: one-way ANOVAs

##### Crawling
```{r, include = T, echo=FALSE, warning=FALSE}

aov_partial <- lineplot_B_longer %>%
  filter(milestone == "crawling_age")
aov_1 <- aov(age_at_element ~ group, data = aov_partial)
summary(aov_1)
effectsize::eta_squared(aov_1, partial = FALSE)
```

##### Babbling
```{r, include = T, echo=FALSE, warning=FALSE}
aov_partial <- lineplot_B_longer %>%
  filter(milestone == "babbling_age")
aov_1 <- aov(age_at_element ~ group, data = aov_partial)
summary(aov_1)
effectsize::eta_squared(aov_1, partial = FALSE)
```

##### Walking
```{r, include = T, echo=FALSE, warning=FALSE}
aov_partial <- lineplot_B_longer %>%
  filter(milestone == "walking_age")
aov_1 <- aov(age_at_element ~ group, data = aov_partial)
summary(aov_1)
effectsize::eta_squared(aov_1, partial = FALSE)
```

##### Word1
```{r, include = T, echo=FALSE, warning=FALSE}
aov_partial <- lineplot_B_longer %>%
  filter(milestone == "w1")
aov_1 <- aov(age_at_element ~ group, data = aov_partial)
summary(aov_1)
effectsize::eta_squared(aov_1, partial = FALSE)
```

##### Word10
```{r, include = T, echo=FALSE, warning=FALSE}
aov_partial <- lineplot_B_longer %>%
  filter(milestone == "w10")
summary(aov(age_at_element ~ group, data = aov_partial))
```

##### Word50
```{r, include = T, echo=FALSE, warning=FALSE}
aov_partial <- lineplot_B_longer %>%
  filter(milestone == "w50")
summary(aov(age_at_element ~ group, data = aov_partial))
```

##### Multiword1
```{r, include = T, echo=FALSE, warning=FALSE}
aov_partial <- lineplot_B_longer %>%
  filter(milestone == "m1")
summary(aov(age_at_element ~ group, data = aov_partial))
```

##### Multiword3
```{r, include = T, echo=FALSE, warning=FALSE}
aov_partial <- lineplot_B_longer %>%
  filter(milestone == "m3")
aov_m3 <- aov(age_at_element ~ group, data = aov_partial)
summary(aov_m3)

```
#### Appendix B: Bayes Factor

```{r, include = T, echo= T, warning=FALSE}
lineplot_B <- lineplot_B_longer %>%
  pivot_wider(id_cols = c(child_anonim, group), names_from = milestone, values_from = age_at_element)

# Following Hoijtink, H., Mulder, J., Van Lissa, C., & Gu, X. (2019). A tutorial on testing hypotheses using the Bayes factor. Psychological Methods, 24(5), 539–556. https://doi.org/10.1037/met0000201
```

##### Crawling
```{r, include = T, echo=FALSE, warning=FALSE}

prepbf <-  lm(crawling_age~group-1, data=lineplot_B) #Without the -1 regular dummy coding would have been applied
coef(prepbf)
set.seed(100)
resbf<-bain(prepbf,"groupBilinguals = groupMonolinguals1 = groupMonolinguals2")
print(resbf)

# Sensitivity Analysis
# compute BF01 using b-g (same BF as printed above)
set.seed(100)
resbf_sa<-bain(prepbf,"groupBilinguals = groupMonolinguals1 = groupMonolinguals2", fraction = 1)
print(resbf_sa)
# compute BF01 replacing b-g by 2 x b-g
# setting fraction to 2 implies using 2 x b-g
set.seed(100)
resbf_sa<-bain(prepbf,"groupBilinguals = groupMonolinguals1 = groupMonolinguals2", fraction = 2)
print(resbf_sa)
# compute BF01 replacing b-g by 3 x b-g
set.seed(100)
resbf_sa<-bain(prepbf,"groupBilinguals = groupMonolinguals1 = groupMonolinguals2", fraction = 3)
print(resbf_sa)
```

##### Babbling
```{r, include = T, echo=FALSE, warning=FALSE}

# babbling
prepbf <-  lm(babbling_age~group-1, data=lineplot_B)
coef(prepbf)
set.seed(100)
resbf<-bain(prepbf,"groupBilinguals = groupMonolinguals1 = groupMonolinguals2")
print(resbf)

# Sensitivity Analysis
# compute BF01 using b-g (same BF as printed above)
set.seed(100)
resbf_sa<-bain(prepbf,"groupBilinguals = groupMonolinguals1 = groupMonolinguals2", fraction = 1)
print(resbf_sa)
# compute BF01 replacing b-g by 2 x b-g
# setting fraction to 2 implies using 2 x b-g
set.seed(100)
resbf_sa<-bain(prepbf,"groupBilinguals = groupMonolinguals1 = groupMonolinguals2", fraction = 2)
print(resbf_sa)
# compute BF01 replacing b-g by 3 x b-g
set.seed(100)
resbf_sa<-bain(prepbf,"groupBilinguals = groupMonolinguals1 = groupMonolinguals2", fraction = 3)
print(resbf_sa)
```

##### Walking
```{r, include = T, echo=FALSE, warning=FALSE}

# walking
prepbf <-  lm(walking_age~group-1, data=lineplot_B)
coef(prepbf)
set.seed(100)
resbf<-bain(prepbf,"groupBilinguals = groupMonolinguals1 = groupMonolinguals2")
print(resbf)

# Sensitivity Analysis
# compute BF01 using b-g (same BF as printed above)
set.seed(100)
resbf_sa<-bain(prepbf,"groupBilinguals = groupMonolinguals1 = groupMonolinguals2", fraction = 1)
print(resbf_sa)
# compute BF01 replacing b-g by 2 x b-g
# setting fraction to 2 implies using 2 x b-g
set.seed(100)
resbf_sa<-bain(prepbf,"groupBilinguals = groupMonolinguals1 = groupMonolinguals2", fraction = 2)
print(resbf_sa)
# compute BF01 replacing b-g by 3 x b-g
set.seed(100)
resbf_sa<-bain(prepbf,"groupBilinguals = groupMonolinguals1 = groupMonolinguals2", fraction = 3)
print(resbf_sa)
```

##### Word1
```{r, include = T, echo=FALSE, warning=FALSE}

# word1
prepbf <-  lm(w1~group-1, data=lineplot_B)
coef(prepbf)
set.seed(100)
resbf<-bain(prepbf,"groupBilinguals = groupMonolinguals1 = groupMonolinguals2")
print(resbf)

# Sensitivity Analysis
# compute BF01 using b-g (same BF as printed above)
set.seed(100)
resbf_sa<-bain(prepbf,"groupBilinguals = groupMonolinguals1 = groupMonolinguals2", fraction = 1)
print(resbf_sa)
# compute BF01 replacing b-g by 2 x b-g
# setting fraction to 2 implies using 2 x b-g
set.seed(100)
resbf_sa<-bain(prepbf,"groupBilinguals = groupMonolinguals1 = groupMonolinguals2", fraction = 2)
print(resbf_sa)
# compute BF01 replacing b-g by 3 x b-g
set.seed(100)
resbf_sa<-bain(prepbf,"groupBilinguals = groupMonolinguals1 = groupMonolinguals2", fraction = 3)
print(resbf_sa)
```

##### Word10
```{r, include = T, echo=FALSE, warning=FALSE}

# word10
prepbf <-  lm(w10~group-1, data=lineplot_B)
coef(prepbf)
set.seed(100)
resbf<-bain(prepbf,"groupBilinguals = groupMonolinguals1 = groupMonolinguals2")
print(resbf)

# Sensitivity Analysis
# compute BF01 using b-g (same BF as printed above)
set.seed(100)
resbf_sa<-bain(prepbf,"groupBilinguals = groupMonolinguals1 = groupMonolinguals2", fraction = 1)
print(resbf_sa)
# compute BF01 replacing b-g by 2 x b-g
# setting fraction to 2 implies using 2 x b-g
set.seed(100)
resbf_sa<-bain(prepbf,"groupBilinguals = groupMonolinguals1 = groupMonolinguals2", fraction = 2)
print(resbf_sa)
# compute BF01 replacing b-g by 3 x b-g
set.seed(100)
resbf_sa<-bain(prepbf,"groupBilinguals = groupMonolinguals1 = groupMonolinguals2", fraction = 3)
print(resbf_sa)
```

##### Word50
```{r, include = T, echo=FALSE, warning=FALSE}

# word50
prepbf <-  lm(w50~group-1, data=lineplot_B)
coef(prepbf)
set.seed(100)
resbf<-bain(prepbf,"groupBilinguals = groupMonolinguals1 = groupMonolinguals2")
print(resbf)

# Sensitivity Analysis
# compute BF01 using b-g (same BF as printed above)
set.seed(100)
resbf_sa<-bain(prepbf,"groupBilinguals = groupMonolinguals1 = groupMonolinguals2", fraction = 1)
print(resbf_sa)
# compute BF01 replacing b-g by 2 x b-g
# setting fraction to 2 implies using 2 x b-g
set.seed(100)
resbf_sa<-bain(prepbf,"groupBilinguals = groupMonolinguals1 = groupMonolinguals2", fraction = 2)
print(resbf_sa)
# compute BF01 replacing b-g by 3 x b-g
set.seed(100)
resbf_sa<-bain(prepbf,"groupBilinguals = groupMonolinguals1 = groupMonolinguals2", fraction = 3)
print(resbf_sa)
```


##### Multiword1
```{r, include = T, echo=FALSE, warning=FALSE}

# multiword1
prepbf <-  lm(m1~group-1, data=lineplot_B)
coef(prepbf)
set.seed(100)
resbf<-bain(prepbf,"groupBilinguals = groupMonolinguals1 = groupMonolinguals2")
print(resbf)

# Sensitivity Analysis
# compute BF01 using b-g (same BF as printed above)
set.seed(100)
resbf_sa<-bain(prepbf,"groupBilinguals = groupMonolinguals1 = groupMonolinguals2", fraction = 1)
print(resbf_sa)
# compute BF01 replacing b-g by 2 x b-g
# setting fraction to 2 implies using 2 x b-g
set.seed(100)
resbf_sa<-bain(prepbf,"groupBilinguals = groupMonolinguals1 = groupMonolinguals2", fraction = 2)
print(resbf_sa)
# compute BF01 replacing b-g by 3 x b-g
set.seed(100)
resbf_sa<-bain(prepbf,"groupBilinguals = groupMonolinguals1 = groupMonolinguals2", fraction = 3)
print(resbf_sa)
```

##### Multiword3
```{r, include = T, echo=FALSE, warning=FALSE}

# multiword3
prepbf <-  lm(m3~group-1, data=lineplot_B)
coef(prepbf)
set.seed(100)
resbf<-bain(prepbf,"groupBilinguals = groupMonolinguals1 = groupMonolinguals2")
print(resbf)

# Sensitivity Analysis
# compute BF01 using b-g (same BF as printed above)
set.seed(100)
resbf_sa<-bain(prepbf,"groupBilinguals = groupMonolinguals1 = groupMonolinguals2", fraction = 1)
print(resbf_sa)
# compute BF01 replacing b-g by 2 x b-g
# setting fraction to 2 implies using 2 x b-g
set.seed(100)
resbf_sa<-bain(prepbf,"groupBilinguals = groupMonolinguals1 = groupMonolinguals2", fraction = 2)
print(resbf_sa)
# compute BF01 replacing b-g by 3 x b-g
set.seed(100)
resbf_sa<-bain(prepbf,"groupBilinguals = groupMonolinguals1 = groupMonolinguals2", fraction = 3)
print(resbf_sa)

# multiword4
# too small samples

```


### Appendix C

Bilinguals from the UK and Norway

```{r children from pre-registered rq2}

reg_bi <- merge(rq2, kids[, c("child_anonim", "country")], by = "child_anonim", all.x = T)

reg_bi <- reg_bi %>%
  filter(!is.na(country))

reg_bi %>%
  group_by(country) %>%
  dplyr::summarise(n = length(child_anonim)) # note: each child is two rows if they have data for both languages

reg_w1 <- reg_bi %>%
  dplyr::select("child_anonim", "language_new", "w1", "country") %>%
  pivot_wider(names_from = language_new, values_from = w1) %>%
  filter(complete.cases(HL, ML)) %>%
  pivot_longer(cols = c(HL, ML), names_to = "language_new", values_to = "age_at_element") %>%
  mutate(milestone = "w1") %>% dplyr::relocate(milestone, .before = child_anonim)

# w1 - how many kids?
reg_w1 %>%
  group_by(country) %>%
  dplyr::summarise(n = length(child_anonim)) # note: each child is two rows - they have data for both languages


```


```{r, include = T, echo=FALSE, warning=FALSE}
# we take only the vars we want for RQ2
lineplot_C <- reg_bi %>% filter(country == "UK" | country == "NORWAY")

# for each milestone, we want to include only children who have info from both languages
# we will create seperate dfs for each milestone (filter out incomplete observations)
# and then rbind these separate dfs into one, to draw a plot upon it.

# w1
reg_w1 <- lineplot_C %>%
  dplyr::select("child_anonim", "language_new", "w1", "country") %>%
  pivot_wider(names_from = language_new, values_from = w1) %>%
  filter(complete.cases(HL, ML)) %>%
  pivot_longer(cols = c(HL, ML), names_to = "language_new", values_to = "age_at_element") %>%
  mutate(milestone = "w1") %>% dplyr::relocate(milestone, .before = child_anonim)

reg_w1_se <- reg_w1 %>%
  summarySE(measurevar = "age_at_element", groupvars = c("language_new", "country"), na.rm = T) %>%
  mutate(milestone = "w1") %>% dplyr::relocate(milestone, .before = language_new)

#w10
reg_w10 <- lineplot_C %>%
  dplyr::select("child_anonim", "language_new", "w10", "country") %>%
  pivot_wider(names_from = language_new, values_from = w10) %>%
  filter(complete.cases(HL, ML)) %>%
  pivot_longer(cols = c(HL, ML), names_to = "language_new", values_to = "age_at_element") %>%
  mutate(milestone = "w10") %>% dplyr::relocate(milestone, .before = child_anonim)
reg_w10_se <- reg_w10 %>%
  summarySE(measurevar = "age_at_element", groupvars = c("language_new", "country"), na.rm = T) %>%
  mutate(milestone = "w10") %>% dplyr::relocate(milestone, .before = language_new)

#w50
#none
reg_w50 <- lineplot_C %>%
  dplyr::select("child_anonim", "language_new", "w50", "country") %>%
  pivot_wider(names_from = language_new, values_from = w50) %>%
  filter(complete.cases(HL, ML)) %>%
  pivot_longer(cols = c(HL, ML), names_to = "language_new", values_to = "age_at_element") %>%
  mutate(milestone = "w50") %>% dplyr::relocate(milestone, .before = child_anonim)
# no data for summarySE

#m1
reg_m1 <- lineplot_C %>%
  dplyr::select("child_anonim", "language_new", "m1", "country") %>%
  pivot_wider(names_from = language_new, values_from = m1) %>%
  filter(complete.cases(HL, ML)) %>%
  pivot_longer(cols = c(HL, ML), names_to = "language_new", values_to = "age_at_element") %>%
  mutate(milestone = "m1") %>% dplyr::relocate(milestone, .before = child_anonim)
reg_m1_se <- reg_m1 %>%
  summarySE(measurevar = "age_at_element", groupvars = c("language_new", "country"), na.rm = T) %>%
  mutate(milestone = "m1") %>% dplyr::relocate(milestone, .before = language_new)

#m3
reg_m3 <- lineplot_C %>%
  dplyr::select("child_anonim", "language_new", "m3", "country") %>%
  pivot_wider(names_from = language_new, values_from = m3) %>%
  filter(complete.cases(HL, ML)) %>%
  pivot_longer(cols = c(HL, ML), names_to = "language_new", values_to = "age_at_element") %>%
  mutate(milestone = "m3") %>% dplyr::relocate(milestone, .before = child_anonim)
# no data for summarySE

#m4
reg_m4 <- lineplot_C %>%
  dplyr::select("child_anonim", "language_new", "m4") %>%
  pivot_wider(names_from = language_new, values_from = m4) %>%
  filter(complete.cases(HL, ML)) %>%
  pivot_longer(cols = c(HL, ML), names_to = "language_new", values_to = "age_at_element") %>%
  mutate(milestone = "m4") %>% dplyr::relocate(milestone, .before = child_anonim)
# no data for summarySE

# summary
lineplot_reg_sum <- rbind(reg_w1_se, reg_w10_se, reg_m1_se)
lineplot_C <- rbind(reg_w1, reg_w10, reg_m1)
lineplot_C <- lineplot_C %>% pivot_wider(id_cols = c(child_anonim, country, language_new), names_from = milestone, values_from = age_at_element)


```


#### Polish-English bilinguals in the UK

```{r, include = T, echo = F, warning = F}

str(lineplot_C)
lineplot_C$country <- as.factor(lineplot_C$country)
lineplot_C$language_new <- as.factor(lineplot_C$language_new)

lineplot_C$w1 <- as.numeric(unlist(lineplot_C$w1))
lineplot_C$w10 <- as.numeric(unlist(lineplot_C$w10))
lineplot_C$m1 <- as.numeric(unlist(lineplot_C$m1))

lineplot_C %>%
  dplyr::group_by(country, language_new) %>%
  dplyr::summarise(
    "w1 n" = sum(!is.na(w1)),
    "w1 Age (M) " = specify_decimal(mean(w1, na.rm = T),2),
    "w1 Age (SD) " = specify_decimal(sd(w1, na.rm = T),2),
    "w10 n" = sum(!is.na(w10)),
    "w10 Age (M) " = specify_decimal(mean(w10, na.rm = T),2),
    "w10 Age (SD) " = specify_decimal(sd(w10, na.rm = T),2),
    "m1 n" = sum(!is.na(m1)),
    "m1 Age (M) " = specify_decimal(mean(m1, na.rm = T),2),
    "m1 Age (SD) " = specify_decimal(sd(m1, na.rm = T),2),
    .groups = "keep") %>%
  kable("html") %>% kable_styling()
```


##### Word1
```{r, include = T, echo= T, warning=FALSE}
reg_w1 %>%
  filter(country == "UK") %>%
  rstatix::t_test(age_at_element ~ language_new, paired = T, var.equal = T, conf.level = 0.95, detailed = T) %>%
  kable("html") %>% kable_styling()
```


```{r, include = T, echo= T, warning=FALSE}
# w1
prebf_df <- reg_w1 %>% filter(country == "UK")
prepbf <-  lm(age_at_element~language_new-1, data=prebf_df)
coef(prepbf)
set.seed(100)
resbf<-bain(prepbf,"language_newHL = language_newML")
print(resbf)

# Sensitivity Analysis
# compute BF01 using b-g (same BF as printed above)
resbf_sa<-bain(prepbf,"language_newHL = language_newML", fraction = 1)
print(resbf_sa)
# compute BF01 replacing b-g by 2 x b-g
# setting fraction to 2 implies using 2 x b-g
set.seed(100)
resbf_sa<-bain(prepbf,"language_newHL = language_newML", fraction = 2)
print(resbf_sa)
# compute BF01 replacing b-g by 3 x b-g
set.seed(100)
resbf_sa<-bain(prepbf,"language_newHL = language_newML", fraction = 3)
print(resbf_sa)
```


#### Polish-Norwegian bilinguals in Norway

##### Word1
```{r, include = T, echo= T, warning=FALSE}
reg_w1 %>%
  filter(country == "NORWAY") %>%
  rstatix::t_test(age_at_element ~ language_new, paired = T, var.equal = T, conf.level = 0.95, detailed = T) %>%
  kable("html") %>% kable_styling()
```


```{r, include = T, echo= T, warning=FALSE}
# w1
prebf_df <- reg_w1 %>% filter(country == "NORWAY")
prepbf <-  lm(age_at_element~language_new-1, data=prebf_df)
coef(prepbf)
set.seed(100)
resbf<-bain(prepbf,"language_newHL = language_newML")
print(resbf)

# Sensitivity Analysis
# compute BF01 using b-g (same BF as printed above)
resbf_sa<-bain(prepbf,"language_newHL = language_newML", fraction = 1)
print(resbf_sa)
# compute BF01 replacing b-g by 2 x b-g
# setting fraction to 2 implies using 2 x b-g
set.seed(100)
resbf_sa<-bain(prepbf,"language_newHL = language_newML", fraction = 2)
print(resbf_sa)
# compute BF01 replacing b-g by 3 x b-g
set.seed(100)
resbf_sa<-bain(prepbf,"language_newHL = language_newML", fraction = 3)
print(resbf_sa)
```
